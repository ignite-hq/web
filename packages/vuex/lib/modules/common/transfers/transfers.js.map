{"version":3,"sources":["../../../../src/modules/common/transfers/transfers.js"],"names":["getDefaultState","Transactions","_Subscriptions","Set","state","namespaced","mutations","RESET_STATE","Object","assign","STORE_TRANSACTIONS","address","page","txs","total","SUBSCRIBE","subscription","add","UNSUBSCRIBE","getters","getTransactions","actions","init","dispatch","rootGetters","console","log","on","resetState","commit","unsubscribe","StoreUpdate","forEach","action","payload","QueryTransactions","subscribe","axios","get","received","data","result","sent","Number","total_count","sort","a","b","height","index","error","SpVuexError"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport SpVuexError from '../../../errors/SpVuexError';\n\nconst getDefaultState = () => {\n\treturn {\n\t\tTransactions: {},\n\t\t_Subscriptions: new Set(),\n\t};\n};\n// initial state\nconst state = getDefaultState();\nexport default {\n\tnamespaced: true,\n\tstate,\n\tmutations: {\n\t\tRESET_STATE(state) {\n\t\t\tObject.assign(state, getDefaultState());\n\t\t},\n\t\tSTORE_TRANSACTIONS(state, { address, page, txs,total }) {\n\t\t\tif(!state.Transactions[address]) {\n\t\t\t\tstate.Transactions[address]={}\n\t\t\t}\n\t\t\tstate.Transactions[address][page] = txs;\n\t\t\tstate.Transactions[address]['total']=total\n\t\t},\n\t\tSUBSCRIBE(state, subscription) {\n\t\t\tstate._Subscriptions.add(subscription);\n\t\t},\n\t\tUNSUBSCRIBE(state, subscription) {\n\t\t\tstate._Subscriptions.delete(subscription);\n\t\t}\n\t},\n\tgetters: {\n\t\tgetTransactions: (state) => (address) => {\n\t\t\t\n\t\t\treturn state.Transactions[address]?state.Transactions[address]:null\n\t\t}\t\t\n\t},\n\tactions: {\n\t\tinit({ dispatch, rootGetters }) {\n\t\t\tconsole.log('init');\n\t\t\tif (rootGetters['common/env/client']) {\n\t\t\t\trootGetters['common/env/client'].on('newblock', () => {\n\t\t\t\t\tdispatch('StoreUpdate');\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tresetState({ commit }) {\n\t\t\tcommit('RESET_STATE');\n\t\t},\n\t\tunsubscribe({ commit }, subscription) {\n\t\t\tcommit('UNSUBSCRIBE', subscription);\n\t\t},\n\t\tasync StoreUpdate({ state, dispatch }) {\n\t\t\tstate._Subscriptions.forEach((subscription) => {\n\t\t\t\tdispatch(subscription.action, subscription.payload);\n\t\t\t}); \n\t\t},\n\t\tasync QueryTransactions({ commit, rootGetters,getters }, { subscribe = false, address, page = 1 }) {\n\t\t\ttry {\n\t\t\t\tlet received = (await axios.get(\n\t\t\t\t\trootGetters['common/env/apiTendermint'] + '/tx_search?query=\"transfer.recipient=%27'+address+'%27\"&prove=false&per_page=10&page='+page)).data.result\n\t\t\t\t\t\n\t\t\t\tlet sent = (await axios.get(\n\t\t\t\t\trootGetters['common/env/apiTendermint'] + '/tx_search?query=\"transfer.sender=%27'+address+'%27\"&prove=false&per_page=10&page='+page)).data.result\n\t\t\t\t\t\n\t\t\t\tlet total = Number(received.total_count)+Number(sent.total_count)\n\t\t\t\tlet txs=[...received.txs, ...sent.txs].sort((a,b) => { return a.height==b.height?b.index-a.index:b.height-a.height })\n\t\t\t\tcommit('STORE_TRANSACTIONS', { address, page, txs,total });\n\t\t\t\tif (subscribe)\n\t\t\t\t\tcommit('SUBSCRIBE', { action: 'QueryTransactions', payload: { address, page } });\n\t\t\t\t\n\t\t\t\treturn getters['getTransactions'](address,page)\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error(new SpVuexError('Common:Transfers:QueryTransactions', 'RPC Node Unavailable. Could not perform query.'));\n\t\t\t\treturn {};\n\t\t\t}\n\t\t},\n\t}\n};\n"],"file":"transfers.js"}